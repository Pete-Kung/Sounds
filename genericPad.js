// === CONFIGURABLE SECTION ===
const allSounds = {
  soundsA: [
    {
      name: "Drum 1",
      file: "US_DTH_Drum_124_Bong_STRIPPED.wav",
      container: "padA-1",
      btnButton: "default",
    },
    {
      name: "Drum 2",
      file: "US_DTH_Drum_124_Block_TOP.wav",
      container: "padA-1",
      btnButton: "default",
    },
    {
      name: "Drum 3",
      file: "US_DTH_Drum_124_Bull_FULL.wav",
      container: "padA-1",
      btnButton: "default",
    },
    {
      name: "Drum 4",
      file: "US_DTH_Drum_124_Hotel_FULL.wav",
      container: "padA-1",
      btnButton: "default",
    },

    {
      name: "Bass 1",
      file: "US_DTH_Bass_124_May_Fm.wav",
      container: "padA-2",
      btnButton: "default",
    },
    {
      name: "Bass 2",
      file: "US_DTH_Bass_124_Dark_Dm.wav",
      container: "padA-2",
      btnButton: "default",
    },
    {
      name: "Bass 3",
      file: "US_DTH_Bass_124_Great_Em.wav",
      container: "padA-2",
      btnButton: "default",
    },
    {
      name: "Bass 4",
      file: "US_DTH_Bass_124_Marriage_Am.wav",
      container: "padA-2",
      btnButton: "default",
    },

    {
      name: "Pad 1",
      file: "US_DTH_Pad_124_Future.wav",
      container: "padA-3",
      btnButton: "default",
    },
    {
      name: "Pad 2",
      file: "US_DTH_Pad_124_Gazzelle.wav",
      container: "padA-3",
      btnButton: "default",
    },
    {
      name: "Pad 3",
      file: "US_DTH_Pad_124_Pray.wav",
      container: "padA-3",
      btnButton: "default",
    },
    {
      name: "Pad 4",
      file: "US_DTH_Pad_124_Remesh.wav",
      container: "padA-3",
      btnButton: "default",
    },

    {
      name: "Synth 1",
      file: "US_DTH_Synth_124_Again.wav",
      container: "padA-4",
      btnButton: "default",
    },
    {
      name: "Synth 2",
      file: "US_DTH_Synth_124_Agree_G.wav",
      container: "padA-4",
      btnButton: "default",
    },
    {
      name: "Synth 3",
      file: "US_DTH_Synth_124_Begin.wav",
      container: "padA-4",
      btnButton: "default",
    },
    {
      name: "Synth 4",
      file: "US_DTH_Synth_124_Brother_Fm.wav",
      container: "padA-4",
      btnButton: "default",
    },

    {
      name: "FX 1",
      file: "US_DTH_FX_Venice.wav",
      container: "padA-5",
      btnButton: "default",
    },
    {
      name: "FX 2",
      file: "US_DTH_FX_Result.wav",
      container: "padA-5",
      btnButton: "default",
    },
    {
      name: "FX 3",
      file: "US_DTH_FX_USA.wav",
      container: "padA-5",
      btnButton: "default",
    },
    {
      name: "FX 4",
      file: "US_DTH_FX_National.wav",
      container: "padA-5",
      btnButton: "default",
    },
  ],
  soundsB: [
    {
      name: "Drum 1",
      file: "Drum_130_01.wav",
      container: "padB-1",
      btnButton: "default",
    },
    {
      name: "Drum 2",
      file: "Drum_130_02.wav",
      container: "padB-1",
      btnButton: "default",
    },
    {
      name: "Drum 3",
      file: "Drum_130_03.wav",
      container: "padB-1",
      btnButton: "default",
    },
    {
      name: "Drum 4",
      file: "Drum_130_04.wav",
      container: "padB-1",
      btnButton: "default",
    },

    {
      name: "Bass 1",
      file: "Bass_130_01.wav",
      container: "padB-2",
      btnButton: "default",
    },
    {
      name: "Bass 2",
      file: "Bass_130_02.wav",
      container: "padB-2",
      btnButton: "default",
    },
    {
      name: "Bass 3",
      file: "Bass_130_03.wav",
      container: "padB-2",
      btnButton: "default",
    },
    {
      name: "Bass 4",
      file: "Bass_130_04.wav",
      container: "padB-2",
      btnButton: "default",
    },

    {
      name: "Pad 1",
      file: "Pad_130_01.wav",
      container: "padB-3",
      btnButton: "default",
    },
    {
      name: "Pad 2",
      file: "Pad_130_02.wav",
      container: "padB-3",
      btnButton: "default",
    },
    {
      name: "Pad 3",
      file: "Pad_130_03.wav",
      container: "padB-3",
      btnButton: "default",
    },
    {
      name: "Pad 4",
      file: "Pad_130_04.wav",
      container: "padB-3",
      btnButton: "default",
    },

    {
      name: "Synth 1",
      file: "Synth_130_01.wav",
      container: "padB-4",
      btnButton: "default",
    },
    {
      name: "Synth 2",
      file: "Synth_130_02.wav",
      container: "padB-4",
      btnButton: "default",
    },
    {
      name: "Synth 3",
      file: "Synth_130_03.wav",
      container: "padB-4",
      btnButton: "default",
    },
    {
      name: "Synth 4",
      file: "Synth_130_04.wav",
      container: "padB-4",
      btnButton: "default",
    },

    {
      name: "FX 1",
      file: "Fx_130_01.wav",
      container: "padB-5",
      btnButton: "default",
    },
    {
      name: "FX 2",
      file: "Fx_130_02.wav",
      container: "padB-5",
      btnButton: "default",
    },
    {
      name: "FX 3",
      file: "Fx_130_03.wav",
      container: "padB-5",
      btnButton: "default",
    },
    {
      name: "FX 4",
      file: "Fx_130_04.wav",
      container: "padB-5",
      btnButton: "default",
    },
  ],

  soundsC: [
    {
      name: "Drum 1",
      file: "Drum 1-Hip hop Loops 120 bpm.wav",
      container: "padC-1",
      btnButton: "default",
    },
    {
      name: "Drum 2",
      file: "Drum 2-Hip hop Loops 120 bpm.wav",
      container: "padC-1",
      btnButton: "default",
    },
    {
      name: "Drum 3",
      file: "Drum 3-Hip hop Loops 120 bpm.wav",
      container: "padC-1",
      btnButton: "default",
    },
    {
      name: "Drum 4",
      file: "Drum 4-Hip hop Loops 120 bpm.wav",
      container: "padC-1",
      btnButton: "default",
    },

    {
      name: "Bass 1",
      file: "Bass 1-Hip hop Loops 120 bpm.wav",
      container: "padC-2",
      btnButton: "default",
    },
    {
      name: "Bass 2",
      file: "Bass 2-Hip hop Loops 120 bpm.wav",
      container: "padC-2",
      btnButton: "default",
    },
    {
      name: "Bass 3",
      file: "Bass 3-Hip hop Loops 120 bpm.wav",
      container: "padC-2",
      btnButton: "default",
    },
    {
      name: "Bass 4",
      file: "Bass 4-Hip hop Loops 120 bpm.wav",
      container: "padC-2",
      btnButton: "default",
    },

    {
      name: "Pad 1",
      file: "Pad 1-Hip hop Loops 120 bpm.wav",
      container: "padC-3",
      btnButton: "default",
    },
    {
      name: "Pad 2",
      file: "Pad 2-Hip hop Loops 120 bpm.wav",
      container: "padC-3",
      btnButton: "default",
    },
    {
      name: "Pad 3",
      file: "Pad 3-Hip hop Loops 120 bpm.wav",
      container: "padC-3",
      btnButton: "default",
    },
    {
      name: "Pad 4",
      file: "Pad 4-Hip hop Loops 120 bpm.wav",
      container: "padC-3",
      btnButton: "default",
    },

    {
      name: "Synth 1",
      file: "Synth 1-Hip hop Loops 120 bpm.wav",
      container: "padC-4",
      btnButton: "default",
    },
    {
      name: "Synth 2",
      file: "Synth 2-Hip hop Loops 120 bpm.wav",
      container: "padC-4",
      btnButton: "default",
    },
    {
      name: "Synth 3",
      file: "Synth 3-Hip hop Loops 120 bpm.wav",
      container: "padC-4",
      btnButton: "default",
    },
    {
      name: "Synth 4",
      file: "Synth 4-Hip hop Loops 120 bpm.wav",
      container: "padC-4",
      btnButton: "default",
    },

    {
      name: "FX 1",
      file: "FX 1-Hip hop Loops 120 bpm.wav",
      container: "padC-5",
      btnButton: "default",
    },
    {
      name: "FX 2",
      file: "FX 2-Hip hop Loops 120 bpm.wav",
      container: "padC-5",
      btnButton: "default",
    },
    {
      name: "FX 3",
      file: "FX 3-Hip hop Loops 120 bpm.wav",
      container: "padC-5",
      btnButton: "default",
    },
    {
      name: "FX 4",
      file: "FX 4-Hip hop Loops 120 bpm.wav",
      container: "padC-5",
      btnButton: "default",
    },
  ],

  soundsD: [
    {
      name: "Drum 1",
      file: "Drum 1-EDM Loops 120 bpm.wav",
      container: "padD-1",
      btnButton: "default",
    },
    {
      name: "Drum 2",
      file: "Drum 2-EDM Loops 120 bpm.wav",
      container: "padD-1",
      btnButton: "default",
    },
    {
      name: "Drum 3",
      file: "Drum 3-EDM Loops 120 bpm.wav",
      container: "padD-1",
      btnButton: "default",
    },
    {
      name: "Drum 4",
      file: "Drum 4-EDM Loops 120 bpm.wav",
      container: "padD-1",
      btnButton: "default",
    },

    {
      name: "Bass 1",
      file: "Bass 1-EDM Loops 120 bpm.wav",
      container: "padD-2",
      btnButton: "default",
    },
    {
      name: "Bass 2",
      file: "Bass 2-EDM Loops 120 bpm.wav",
      container: "padD-2",
      btnButton: "default",
    },
    {
      name: "Bass 3",
      file: "Bass 3-EDM Loops 120 bpm.wav",
      container: "padD-2",
      btnButton: "default",
    },
    {
      name: "Bass 4",
      file: "Bass 4-EDM Loops 120 bpm.wav",
      container: "padD-2",
      btnButton: "default",
    },

    {
      name: "Pad 1",
      file: "Piano 1-EDM Loops 120 bpm.wav",
      container: "padD-3",
      btnButton: "default",
    },
    {
      name: "Pad 2",
      file: "Piano 2-EDM Loops 120 bpm.wav",
      container: "padD-3",
      btnButton: "default",
    },
    {
      name: "Pad 3",
      file: "Percussion 1-EDM Loops 120 bpm.wav",
      container: "padD-3",
      btnButton: "default",
    },
    {
      name: "Pad 4",
      file: "Percussion 2-EDM Loops 120 bpm.wav",
      container: "padD-3",
      btnButton: "default",
    },

    {
      name: "Synth 1",
      file: "Synth 1-EDM Loops 120 bpm.wav",
      container: "padD-4",
      btnButton: "default",
    },
    {
      name: "Synth 2",
      file: "Synth 5-EDM Loops 120 bpm.wav",
      container: "padD-4",
      btnButton: "default",
    },
    {
      name: "Synth 3",
      file: "Synth 6-EDM Loops 120 bpm.wav",
      container: "padD-4",
      btnButton: "default",
    },
    {
      name: "Synth 4",
      file: "Synth 4-EDM Loops 120 bpm.wav",
      container: "padD-4",
      btnButton: "default",
    },

    {
      name: "FX 1",
      file: "Fx_140_01.wav",
      container: "padD-5",
      btnButton: "default",
    },
    {
      name: "FX 2",
      file: "Fx_140_02.wav",
      container: "padD-5",
      btnButton: "default",
    },
    {
      name: "FX 3",
      file: "Fx_140_03.wav",
      container: "padD-5",
      btnButton: "default",
    },
    {
      name: "FX 4",
      file: "Fx_140_04.wav",
      container: "padD-5",
      btnButton: "default",
    },
  ],
};

// getSounds("deephouse", function (data) {
//   console.log(data);
// });
// getSounds("B", function (data) {
//   console.log(data);
// });
// getSounds("C", function (data) {
//   console.log(data);
// });
// getSounds("D", function (data) {
//   console.log(data);
// });

function createSoundSet({
  sounds,
  padPrefix,
  beatClass,
  categoryClass,
  waveAnimateId,
  audioContext,
  bpm = 120,
  btnStopAll,
}) {
  const beatEls = document.querySelectorAll(`.${beatClass}`);
  const mainGainNode = audioContext.createGain();
  mainGainNode.connect(audioContext.destination);

  let beatDuration = 60 / bpm;
  let beatLoopTimeoutId;
  let beatsPerBar = 4;
  let currentBeat = 0;

  let barDuration = beatDuration * beatsPerBar;

  function beatLoop() {
    beatEls.forEach((el, i) => {
      el.classList.toggle("active", i === currentBeat);
    });
    currentBeat = (currentBeat + 1) % beatsPerBar;
    beatLoopTimeoutId = setTimeout(beatLoop, beatDuration * 1000);
  }

  function bpmUpdate(newBpm) {
    console.log("newBpm", newBpm);

    beatDuration = 60 / newBpm;
    barDuration = beatDuration * beatsPerBar;
    document.querySelectorAll(`.${padPrefix}`).forEach((pad) => {
      if (pad.dataset.playing === "true" && pad.source) {
        pad.source.playbackRate.value = newBpm / 120;
      }
    });
    clearTimeout(beatLoopTimeoutId);
    beatLoop();
  }
  const confirmBpm = document.getElementById("confirmBPM");
  const bpmValue = document.getElementById("bpmSlider");
  confirmBpm.addEventListener("click", () => {
    bpmUpdate(parseInt(bpmValue.value));
    // const getPadId = confirmBpm.dataset.tab;
    // updateLogDataBpm(getPadId, parseInt(bpmValue.value));
  });

  document.querySelectorAll(`.${categoryClass}`).forEach((el) => {
    el.addEventListener("click", () => bpmUpdate(parseInt(bpmValue.value)));
  });

  async function loadBuffer(url) {
    const response = await fetch(url);
    const arrayBuffer = await response.arrayBuffer();
    return await audioContext.decodeAudioData(arrayBuffer);
  }

  function createPad(sound) {
    const pad = document.createElement("div");
    const padName = padPrefix.replace(/pad/i, "");
    pad.classList.add(padPrefix);
    pad.innerText = sound.name;
    pad.dataset.playing = "false";
    pad.dataset.pad = padName;
    pad.dataset.padType = sound.name;
    pad.buffer = null;
    pad.source = null;

    loadBuffer(sound.url).then((buffer) => {
      pad.buffer = buffer;
    });

    const container = document.getElementById(sound.container);

    if (sound.container.endsWith("-5")) {
      pad.addEventListener("mousedown", () => {
        if (pad.dataset.playing !== "true") startFxPad(pad);
      });
      pad.addEventListener("mouseup", () => {
        if (pad.dataset.playing === "true") stopFxPad(pad);
      });
      pad.addEventListener("touchstart", () => {
        if (pad.dataset.playing !== "true") startFxPad(pad);
      });
      pad.addEventListener("touchend", () => {
        if (pad.dataset.playing === "true") stopFxPad(pad);
      });
    } else {
      pad.addEventListener("click", () => toggleLoopPad(pad));
    }

    container.appendChild(pad);
  }

  function startFxPad(pad) {
    const source = audioContext.createBufferSource();
    const gainNode = audioContext.createGain();

    source.buffer = pad.buffer;
    source.loop = false;
    source.connect(gainNode);
    gainNode.connect(mainGainNode);

    pad.source = source;
    pad.gainNode = gainNode;

    updateFxClick(pad.dataset.pad, pad.dataset.padType);

    // ✅ ดึงค่าระดับเสียงจาก slider ปัจจุบัน
    const category = pad.getAttribute("class");
    const slider = document.querySelector(`[data-category="${category}-5"]`);
    const sliderVolume = slider
      ? parseFloat(slider.getAttribute("data-volume") || "1")
      : 1;
    gainNode.gain.setValueAtTime(sliderVolume, audioContext.currentTime);
    console.log(sliderVolume);

    gainNode.gain.setValueAtTime(sliderVolume, audioContext.currentTime);
    source.start(audioContext.currentTime);

    pad.dataset.playing = "true";
    pad.classList.add("playing");

    const stop = () => {
      stopFxPad(pad);
      window.removeEventListener("mouseup", stop);
      window.removeEventListener("touchend", stop);
    };
    window.addEventListener("mouseup", stop);
    window.addEventListener("touchend", stop);
  }

  function stopFxPad(pad) {
    if (pad.source && pad.gainNode) {
      const now = audioContext.currentTime;
      pad.gainNode.gain.linearRampToValueAtTime(0, now + 0.05);
      pad.source.stop(now + 0.05);

      setTimeout(() => {
        pad.source.disconnect();
        pad.gainNode.disconnect();
        pad.source = null;
        pad.gainNode = null;
        pad.dataset.playing = "false";
        pad.classList.remove("playing");
      }, 100);
    }
  }

  function toggleLoopPad(pad) {
    const container = document.getElementById(pad.parentElement.id);
    const currentlyPlaying = container.querySelector(
      `.${padPrefix}[data-playing='true']`
    );

    if (currentlyPlaying && currentlyPlaying !== pad) stopPad(currentlyPlaying);

    if (pad.dataset.playing === "true") {
      stopPad(pad);
    } else {
      queueStartPad(pad);
      updatePadClick(pad.dataset.pad, pad.dataset.padType);
    }
  }

  function queueStartPad(pad) {
    const container = document.getElementById(pad.parentElement.id);

    console.log(container.id);

    const currentlyPlayingPad = container.querySelector(
      "[data-playing='true']"
    );
    const containerPads = document.querySelectorAll(".padContainer");
    let currentlyPlayingPad2 = null;

    containerPads.forEach((containerpad) => {
      const padInContainer = containerpad.querySelector(
        `.${padPrefix}[data-playing='true']`
      );
      if (padInContainer) {
        currentlyPlayingPad2 = padInContainer;
      }
    });

    const lockedTime = audioContext.currentTime;
    const syncedStartTime = Math.ceil(lockedTime / barDuration) * barDuration;

    if (currentlyPlayingPad2 == null) {
      // ✅ ไม่มี pad เล่นอยู่ → เริ่มทันทีแบบไม่ต้อง sync
      actuallyQueuePad(pad, false, lockedTime, lockedTime, container.id); // sync = false
    } else {
      if (currentlyPlayingPad !== pad) {
        stopPad(currentlyPlayingPad);
        const waitTime =
          (currentlyPlayingPad?.pendingStopTime || lockedTime) - lockedTime;
        setTimeout(() => {
          actuallyQueuePad(
            pad,
            true,
            lockedTime,
            syncedStartTime,
            container.id
          );
        }, waitTime * 1000);
      } else {
        actuallyQueuePad(pad, true, lockedTime, syncedStartTime, container.id);
      }
    }
  }

  function actuallyQueuePad(
    pad,
    sync = true,
    lockedTime = audioContext.currentTime,
    startTime = null,
    padId
  ) {
    const actualStartTime = sync
      ? startTime ?? Math.ceil(lockedTime / barDuration) * barDuration
      : lockedTime;

    const currentBeat = Math.floor((lockedTime % barDuration) / beatDuration);

    const source = audioContext.createBufferSource();
    const gainNode = audioContext.createGain();

    // Wave animation setup
    const analyser = audioContext.createAnalyser();
    analyser.fftSize = 256;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);
    const canvas = document.getElementById(waveAnimateId);
    const canvasCtx = canvas.getContext("2d");

    console.log(
      `[PAD START] startTime: ${actualStartTime.toFixed(
        3
      )}, now: ${lockedTime.toFixed(3)}, diff: ${(
        actualStartTime - lockedTime
      ).toFixed(3)}`
    );

    source.buffer = pad.buffer;
    source.loop = true;

    // ✅ Correct signal chain
    source.connect(gainNode);
    gainNode.connect(analyser);
    analyser.connect(mainGainNode);

    // ✅ Start drawing waveform
    if (waveAnimateId === "waveformCanvasA") {
      drawWavePeaks(analyser, canvas, canvasCtx, dataArray);
    } else if (waveAnimateId === "waveformCanvasB") {
      drawSoftBars(analyser, canvas, canvasCtx, dataArray);
    } else if (waveAnimateId === "waveformCanvasC") {
      drawCircularBars(analyser, canvas, canvasCtx, dataArray);
    } else if (waveAnimateId === "waveformCanvasD") {
      drawWaveformLine(analyser, canvas, canvasCtx, dataArray);
    }

    pad.source = source;
    pad.gainNode = gainNode;

    const padContainer = padId.replace(/-\d+$/, "");
    const volumeControll = document.querySelectorAll(`.${padContainer}-volume`);
    volumeControll.forEach((div) => {
      if (div.dataset.category === padId) {
        const setVolume = div.dataset.volume;
        gainNode.gain.setValueAtTime(setVolume, actualStartTime);
      }
    });

    source.start(actualStartTime);

    pad.dataset.playing = "true";
    pad.classList.add("playing");

    const nextStartTime = Math.ceil(lockedTime / barDuration) * barDuration;
    pad.pendingStopTime = nextStartTime;

    if (sync) {
      beatEls[currentBeat].classList.add("pending");
      setTimeout(() => {
        beatEls[currentBeat].classList.remove("pending");
      }, (nextStartTime - lockedTime) * 1000);
    }
  }

  function stopPad(pad) {
    if (pad && pad.source && pad.gainNode) {
      try {
        pad.source.stop();
        pad.source.disconnect();
        pad.gainNode.disconnect();
      } catch (e) {
        console.warn("Error stopping pad", e);
      }
      pad.source = null;
      pad.gainNode = null;
      pad.dataset.playing = "false";
      pad.classList.remove("playing");
    }
  }

  const stopAllButton = document.getElementById(btnStopAll);
  stopAllButton?.addEventListener("click", () => {
    stopAllPads(padPrefix);
    updateStopPad(padPrefix);
  });
  function stopAllPads() {
    document
      .querySelectorAll(`.${padPrefix}[data-playing='true']`)
      .forEach(stopPad);
  }

  // ✅ รายชื่อ event ที่รองรับจาก slider
  const supportedSliderEvents = [
    "slider-change",
    "encoder-change",
    "knob-volume-change",
    "volume-change",
    "knob-change",
  ];

  function setVolumeFromAPI(slider, volume) {
    // ตั้งค่าใน DOM
    slider.setAttribute("data-volume", volume.toString());

    console.log("call setVolume", slider, volume);

    // ดึง container และ ตั้งค่า Gain เช่นเดียวกับใน onSliderChange
    const category = slider.getAttribute("data-category");

    const container = document.getElementById(category);
    if (container) {
      const pads = container.querySelectorAll(`.${padPrefix}`);

      pads.forEach((pad) => {
        if (pad.dataset.playing === "true" && pad.gainNode) {
          pad.gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
        }
      });
    }
  }

  function onSliderChange(e) {
    const slider = e.currentTarget;
    const volume = parseFloat(e.detail.value) / 100;
    console.log(e.currentTarget);

    setVolumeFromAPI(slider, volume);
  }

  // ✅ ผูก event ทุก slider
  supportedSliderEvents.forEach((eventType) => {
    document
      .querySelectorAll(`[data-event-type="${eventType}"]`)
      .forEach((slider) => {
        slider.removeEventListener(eventType, onSliderChange);
        slider.addEventListener(eventType, onSliderChange);
      });
  });

  beatLoop();

  sounds.forEach((sound) => createPad(sound));

  return { setVolumeFromAPI };
}

// === USAGE EXAMPLE ===

let padA, padB, padC, padD;

window.addEventListener("DOMContentLoaded", () => {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();

  padA = createSoundSet({
    sounds: allSounds.soundsA.map((s) => ({
      ...s,
      url: `./sounds/LoopA/${s.file}`,
    })),
    padPrefix: "padA",
    beatClass: "beatA",
    categoryClass: "categoryA",
    waveAnimateId: "waveformCanvasA",
    audioContext,
    bpm: 120,
    btnStopAll: "stopAllBtnA",
  });

  padB = createSoundSet({
    sounds: allSounds.soundsB.map((s) => ({
      ...s,
      url: `./sounds/LoopB/${s.file}`,
    })),
    padPrefix: "padB",
    beatClass: "beatB",
    categoryClass: "categoryB",
    waveAnimateId: "waveformCanvasB",
    audioContext,
    bpm: 120,
    btnStopAll: "stopAllBtnB",
  });

  padC = createSoundSet({
    sounds: allSounds.soundsC.map((s) => ({
      ...s,
      url: `./sounds/LoopC/${s.file}`,
    })),
    padPrefix: "padC",
    beatClass: "beatC",
    categoryClass: "categoryC",
    waveAnimateId: "waveformCanvasC",
    audioContext,
    bpm: 120,
    btnStopAll: "stopAllBtnC",
  });

  padD = createSoundSet({
    sounds: allSounds.soundsD.map((s) => ({
      ...s,
      url: `./sounds/LoopD/${s.file}`,
    })),
    padPrefix: "padD",
    beatClass: "beatD",
    categoryClass: "categoryD",
    waveAnimateId: "waveformCanvasD",
    audioContext,
    bpm: 120,
    btnStopAll: "stopAllBtnD",
  });
});

function setVolumeAI(padName, mData, bpm) {
  // const sampleData = {
  //   drumVolume: 0.5,
  //   bassVolume: 0.5,
  //   padVolume: 0.5,
  //   synthVolume: 0.5,
  //   fxVolume: 0.5,
  // };

  const sampleData = mData

  // เลือก pad object ตามชื่อ padName
  let padObj;
  if (padName === "padA") padObj = padA;
  else if (padName === "padB") padObj = padB;
  else if (padName === "padC") padObj = padC;
  else if (padName === "padD") padObj = padD;
  else {
    console.warn("Unknown pad:", padName);
    return;
  }

  const volumepads = document.querySelectorAll(`.${padName}-volume`);

  volumepads.forEach((volumeEl, index) => {
    const volumeValue = sampleData[Object.keys(sampleData)[index]];

    // ตั้งค่าใน DOM
    volumeEl.setAttribute("data-volume", volumeValue);
    volumeEl.setAttribute("init", (volumeValue * 100).toString());

    const bpmValue = document.getElementById("bpmSlider");
    bpmValue.value = bpm

    console.log(volumeEl, volumeValue);
    padObj.setVolumeFromAPI(volumeEl, volumeValue);
    updateBpm();
  });
}
